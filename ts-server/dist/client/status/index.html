<!DOCTYPE html>
<html>

<head>
  <title>Counter status</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
</head>

<body>
  <h1>Visitor Counter System Status</h1>

  <table class="table">
    <thead>
      <tr>
        <th>Camera</th>
        <th>Internet Connection</th>
        <th>Time since last message</th>
      </tr>
    </thead>
    <tbody id="cameraTable">
    </tbody>
  </table>
  <p>Contact Sofus: <br />Telephone: +45 28 90 08 48 <br />Mail: sofus@addington.dk</p>

  <script src="/socket.io/socket.io.js"></script>

  <script>
    var socket = io();
    var cameraTable = document.getElementById('cameraTable');

    function numParse(x) {
      return Number.parseFloat(x).toFixed(1);
    }

    socket.emit('join', 'status')

    socket.on('update', function (msg) {
      console.log(msg)
      tb = ''
      for (row of msg) {
        const time = Date.now()
        // camera name
        tb = '<tr><td>' + row.sensor + '</td>'

        // Heartbeat
        const heartbeatTime = time - row.heartbeat
        if (heartbeatTime < 8.64e7) {
          tb = tb.concat('<td class = "bg-primary text-light">' + numParse(heartbeatTime/1000/60) + ' minutes</td>')
        } else {
          tb = tb.concat('<td class = "bg-danger text-light">' + numParse(heartbeatTime/1000/60) + ' minutes</td>')
        }
        // Last message
        const lastMsgTime = time - row.lastMsg
        if (lastMsgTime < 8.64e7) {
          tb = tb.concat('<td class = "bg-primary text-light">' + numParse(lastMsgTime/1000/60) + ' minutes</td>')
        } else {
          tb = tb.concat('<td class = "bg-danger text-light">' + numParse(lastMsgTime/1000/60) + ' minutes</td>')
        }
      }
      cameraTable.innerHTML = tb
    });
  </script>
</body>

</html>